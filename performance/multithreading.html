

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Multithreading &mdash; Scalable Vector Search 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/sphinx_collapse.css?v=226d88b4" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=d45e8c67"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Static Dimensionality" href="../advanced/static_dimensionality.html" />
    <link rel="prev" title="Vector Compression" href="using_compression.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Scalable Vector Search
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../start.html">Getting started with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../start_cpp.html">Getting started with C++</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features.html">Library Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../howtos.html">How-Tos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../io.html">I/O and Conversion Tools</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Performance Tuning</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="avx512.html">Intel(R) AVX-512</a></li>
<li class="toctree-l2"><a class="reference internal" href="hugepages.html">Huge Pages</a></li>
<li class="toctree-l2"><a class="reference internal" href="using_compression.html">Vector Compression</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Multithreading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/static_dimensionality.html">Static Dimensionality</a></li>
<li class="toctree-l2"><a class="reference internal" href="numa.html">NUMA Systems</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/index.html">Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../benchs/index.html">Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../logging.html">Logging</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../python/common.html">Common Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/loaders.html">Loaders</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/flat.html">Flat Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/vamana.html">Vamana Graph Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/dynamic.html">Dynamic Vamana Graph Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/backend.html">Backend Selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/upgrader.html">Object Upgrader</a></li>
<li class="toctree-l1"><a class="reference internal" href="../python/logging.html">Python Logging API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">C++ Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../cpp/top.html">C++ Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpp/index/index.html">Indexes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpp/core/index.html">Core Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpp/quantization/index.html">Quantization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpp/concepts/index.html">Core Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpp/internal/index.html">Internals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpp/testing.html">Testing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Experimental Python Library</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../python/experimental/leanvec.html">Using LeanVec</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Scalable Vector Search</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Performance Tuning</a></li>
      <li class="breadcrumb-item active">Multithreading</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/performance/multithreading.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="multithreading">
<span id="id1"></span><h1>Multithreading<a class="headerlink" href="#multithreading" title="Link to this heading">ÔÉÅ</a></h1>
<p>SVS throughput can be highly improved by running multiple queries in parallel, as its performance scales very well with
the number of threads (see <a class="reference internal" href="../benchs/static/previous/system_utilization.html#multithreading-scaling"><span class="std std-ref">System utilization - Multithreading</span></a> for benchmarking results). Larger query batch sizes will benefit more
from multi-threaded search.</p>
<p>The number of threads can be specified when loading the index</p>
<p><strong>In Python</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># We can reload an index from a previously saved set of files.</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">svs</span><span class="o">.</span><span class="n">Vamana</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">test_data_dir</span><span class="p">,</span> <span class="s2">&quot;example_config&quot;</span><span class="p">),</span>
    <span class="n">svs</span><span class="o">.</span><span class="n">GraphLoader</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">test_data_dir</span><span class="p">,</span> <span class="s2">&quot;example_graph&quot;</span><span class="p">)),</span>
    <span class="n">svs</span><span class="o">.</span><span class="n">VectorDataLoader</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">test_data_dir</span><span class="p">,</span> <span class="s2">&quot;example_data&quot;</span><span class="p">),</span> <span class="n">svs</span><span class="o">.</span><span class="n">DataType</span><span class="o">.</span><span class="n">float32</span>
    <span class="p">),</span>
    <span class="n">svs</span><span class="o">.</span><span class="n">DistanceType</span><span class="o">.</span><span class="n">L2</span><span class="p">,</span>
    <span class="n">num_threads</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p><strong>In C++</strong></p>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="49bad270-0fdf-41da-9241-0002b28d7a5d" name="49bad270-0fdf-41da-9241-0002b28d7a5d" type="checkbox"><label class="sphinx_collapse__label" for="49bad270-0fdf-41da-9241-0002b28d7a5d"><i class="sphinx_collapse__icon"></i>Click to display</label><div class="sphinx_collapse__content docutils container">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// We can reload an index from a previously saved set of files.</span>
<span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">svs</span><span class="o">::</span><span class="n">Vamana</span><span class="o">::</span><span class="n">assemble</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;example_config&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">svs</span><span class="o">::</span><span class="n">GraphLoader</span><span class="p">(</span><span class="s">&quot;example_graph&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">svs</span><span class="o">::</span><span class="n">VectorDataLoader</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;example_data&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">svs</span><span class="o">::</span><span class="n">DistanceType</span><span class="o">::</span><span class="n">L2</span><span class="p">,</span>
<span class="w">    </span><span class="mi">4</span><span class="w"> </span><span class="c1">// num_threads</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>or at runtime</p>
<p><strong>In Python</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">index</span><span class="o">.</span><span class="n">num_threads</span> <span class="o">=</span> <span class="mi">4</span>
</pre></div>
</div>
<p><strong>In C++</strong></p>
<div class="sphinx_collapse docutils container">
<input class="sphinx_collapse__input" id="8e9f588f-413c-41fe-a278-66dd6300c476" name="8e9f588f-413c-41fe-a278-66dd6300c476" type="checkbox"><label class="sphinx_collapse__label" for="8e9f588f-413c-41fe-a278-66dd6300c476"><i class="sphinx_collapse__icon"></i>Click to display</label><div class="sphinx_collapse__content docutils container">
</div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Make sure to set the number of threads according to the query batch size. Smaller
batch sizes may benefit from using fewer threads, as the overhead of handling multiple threads may be too large.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>To avoid performance degradation make sure to set the number of threads to 1 if running one query at a time.</p>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="using_compression.html" class="btn btn-neutral float-left" title="Vector Compression" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../advanced/static_dimensionality.html" class="btn btn-neutral float-right" title="Static Dimensionality" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Intel Corporation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>